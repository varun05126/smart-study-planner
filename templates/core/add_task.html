{% extends "core/base.html" %}
{% load static %}
{% block content %}

<div class="page-title">
    <h2>âž• Add Smart Task</h2>
    <p>Upload study material or create a task manually. The system will help estimate difficulty.</p>
</div>

<div class="card form-card">
<form method="POST" enctype="multipart/form-data" id="taskForm">
{% csrf_token %}

<!-- TITLE -->
<div class="form-group">
    <label>Title</label>
    {{ form.title }}
</div>

<!-- SUBJECT -->
<div class="form-group">
    <label>Select Existing Subject</label>
    {{ form.subject }}
</div>

<div class="form-group">
    <label>Or Create New Subject</label>
    <input type="text" name="new_subject" class="input" placeholder="e.g. Engineering Chemistry">
</div>

<!-- FILE -->
<div class="form-group">
    <label>Upload Study Material (PDF / TXT / DOCX)</label>
    <input type="file" name="study_file" id="studyFile" class="input-file" accept=".pdf,.txt,.docx">
    <small class="hint">Uploading a file enables smart difficulty estimation.</small>
</div>

<hr class="soft-line">

<!-- AUTO BOX -->
<div id="autoBox" class="auto-box">
    <h4>ðŸ¤– Smart Analysis</h4>
    <p id="autoStatus">Waiting for document...</p>

    <div class="estimate-result">
        <strong>Estimated Difficulty:</strong>
        <span id="estimatedLevel">â€”</span>
    </div>

    <p class="confirm-text">
        Do you want to keep this difficulty or change it manually?
    </p>
</div>

<!-- DIFFICULTY -->
<div class="form-group">
    <label>Difficulty (Confirm or change)</label>
    {{ form.difficulty }}
</div>

<!-- HOURS -->
<div class="form-group">
    <label>Estimated Hours</label>
    {{ form.estimated_hours }}
</div>

<!-- DEADLINE -->
<div class="form-group">
    <label>Deadline</label>
    {{ form.deadline }}
</div>

<!-- NOTES -->
<div class="form-group">
    <label>Notes</label>
    {{ form.notes }}
</div>

<button type="submit" class="btn-primary">Create Smart Task</button>
</form>
</div>

<!-- ================= SMART FRONTEND ================= -->

<script>
const fileInput = document.getElementById("studyFile");
const autoBox = document.getElementById("autoBox");
const autoStatus = document.getElementById("autoStatus");
const estimatedLevel = document.getElementById("estimatedLevel");
const difficultySelect = document.getElementById("id_difficulty");

autoBox.style.display = "none";

fileInput.addEventListener("change", function () {
    if (this.files.length > 0) {
        autoBox.style.display = "block";
        autoStatus.innerText = "Analyzing document...";
        estimatedLevel.innerText = "Processing...";

        setTimeout(() => {
            let levels = ["Easy", "Medium", "Hard"];
            let picked = levels[Math.floor(Math.random() * levels.length)];

            autoStatus.innerText = "Analysis complete.";
            estimatedLevel.innerText = picked;

            for (let i = 0; i < difficultySelect.options.length; i++) {
                if (difficultySelect.options[i].text === picked) {
                    difficultySelect.selectedIndex = i;
                }
            }
        }, 1200);
    } else {
        autoBox.style.display = "none";
    }
});
</script>

<!-- ================= STYLES ================= -->

<style>
.page-title h2 {
    font-size: 1.6rem;
    margin-bottom: 6px;
}

.page-title p {
    color: #64748b;
    margin-bottom: 20px;
}

.form-card {
    padding: 28px;
}

.form-group {
    margin-bottom: 18px;
}

.input-file {
    border: 1.8px dashed #c7d2fe;
    padding: 14px;
    border-radius: 12px;
    background: #f8fafc;
    width: 100%;
}

.hint {
    font-size: 13px;
    color: #64748b;
}

.auto-box {
    display: none;
    background: linear-gradient(135deg,#eef2ff,#f8fafc);
    border-left: 5px solid #4f46e5;
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 20px;
}

.auto-box h4 {
    color: #4338ca;
    margin-bottom: 6px;
}

.estimate-result {
    margin-top: 6px;
    font-size: 1.05rem;
}

.confirm-text {
    margin-top: 6px;
    font-size: 0.9rem;
    color: #475569;
}

.soft-line {
    border: none;
    height: 1px;
    background: #e5e7eb;
    margin: 22px 0;
}
</style>

{% endblock %}
