{% extends "core/base.html" %}
{% block content %}

<h1>Welcome back ğŸ‘‹</h1>
<p>Hereâ€™s your study overview.</p>

<!-- ================= STUDY SESSION ================= -->

<div class="card" style="margin-bottom:22px;">
  <h2>â± Study Session</h2>

  <p><b>Todayâ€™s study time:</b> {{ today_minutes }} minutes</p>

  <a href="{% url 'add_study_session' %}" class="btn-primary">
      Add Study Session
  </a>

  <p style="margin-top:8px;color:#16a34a;">
      Log the time you studied today.
  </p>
</div>

<!-- ================= LEARNING GOAL ================= -->

<div class="card" style="margin-bottom:22px;">
  <h2>ğŸ¯ What do you want to learn?</h2>

  <form method="POST" action="{% url 'learning_goals' %}">
    {% csrf_token %}
    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <input type="text" name="title" required
             placeholder="e.g. Data Structures, Python, AI, Web Development"
             style="flex:1;padding:10px;border-radius:10px;border:1px solid #e5e7eb;">
      <button class="btn-primary">Save Goal</button>
    </div>
  </form>

  {% if current_goal %}
    <p style="margin-top:12px;">
      <strong>Current focus:</strong> 
      <span style="color:#4f46e5;">{{ current_goal.title }}</span>
    </p>
  {% endif %}

  <div style="margin-top:14px;color:#475569;font-size:14px;">
    Popular paths: DSA â€¢ Web Dev â€¢ AI/ML â€¢ Cybersecurity â€¢ Core CS â€¢ Aptitude
  </div>
</div>

<!-- ================= PROGRESS ================= -->

<div class="card" style="margin-bottom:20px;">
  <h3>Overall Progress</h3>
  <div style="background:#e5e7eb;border-radius:20px;overflow:hidden;">
    <div style="width:{{ progress|default:0 }}%;background:#4f46e5;color:white;padding:6px 10px;">
      {{ progress|default:0 }}%
    </div>
  </div>
</div>

<div class="grid-4">
  <div class="card"><h3>Total Tasks</h3><p>{{ total_tasks }}</p></div>
  <div class="card"><h3>Completed</h3><p>{{ completed_count }}</p></div>
  <div class="card"><h3>Pending</h3><p>{{ pending_count }}</p></div>
  <div class="card"><h3>Study Streak</h3><p>{{ streak.current_streak }} days ğŸ”¥</p></div>
</div>

<br>

<div class="grid-2">

<div class="card">
<h2>Your Tasks</h2>

{% for task in tasks %}
  <div style="
    padding:12px;
    border-radius:10px;
    margin-bottom:10px;
    background:{% if task.completed %}#ecfdf5{% elif task.deadline < today %}#fef2f2{% else %}#f8fafc{% endif %};
    border-left:5px solid {% if task.completed %}#10b981{% elif task.deadline < today %}#ef4444{% else %}#6366f1{% endif %};
  ">

    <b>{{ task.title }}</b> â€” {{ task.subject.name }} <br>
    Deadline: {{ task.deadline }}

    {% if task.deadline < today and not task.completed %}
      <span style="color:#dc2626;font-weight:600;">(Overdue)</span>
    {% endif %}

    <div style="margin-top:8px;">
      <a href="{% url 'toggle_task' task.id %}" class="btn-primary" style="padding:6px 12px;">
        {% if task.completed %}â†© Undo{% else %}âœ” Complete{% endif %}
      </a>
    </div>

  </div>
{% empty %}
  <p>No tasks yet. Start adding ğŸš€</p>
{% endfor %}

</div>

<div class="card">
  <h2>Quick Tips</h2>
  <ul>
    <li>âœ” Break tasks into small parts</li>
    <li>âœ” Revise daily</li>
    <li>âœ” Donâ€™t overload a single day</li>
    <li>âœ” Practice problems after every topic</li>
  </ul>
</div>

</div>

{% endblock %}